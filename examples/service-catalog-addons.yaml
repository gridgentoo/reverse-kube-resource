---
# Source: service-catalog-addons/charts/service-binding-usage-controller/templates/clear-cr-job.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: service-catalog-addons-service-binding-usage-controller-cleanup
  labels:
    app: service-catalog-addons-service-binding-usage-controller
    chart: service-binding-usage-controller-0.1.0
    release: service-catalog-addons
    heritage: Helm
  annotations:
    "helm.sh/hook": pre-delete
    "helm.sh/hook-weight": "1"
    "helm.sh/hook-delete-policy": before-hook-creation, hook-succeeded
spec:
  backoffLimit: 1
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: "false"
    spec:
      serviceAccountName: service-catalog-addons-service-binding-usage-controller
      restartPolicy: Never
      containers:
        - name: job
          image: "eu.gcr.io/kyma-project/tpi/k8s-tools:20211022-85284bf9"
          command:
            - bash
            - -c
            - |-
              MAX_RETRIES=60
              cnt=0

              kubectl delete usagekinds.servicecatalog.kyma-project.io deployment > /dev/null 2>&1

              while :
                do
                  kubectl get usagekinds.servicecatalog.kyma-project.io deployment -o=jsonpath='{.metadata.name}' > /dev/null 2>&1
                  if [[ $? -eq "deployment" ]]; then
                    ((cnt++))
                    if (( cnt > $MAX_RETRIES )); then
                    echo "Max retries has been reached (retries $MAX_RETRIES). Exit."
                    exit 1
                  fi

                  echo "Removing usagekinds deployment..."
                  sleep 1
                  else
                    echo "usagekinds deployment has been removed"
                    break
                  fi
              done
---
# Source: service-catalog-addons/charts/service-catalog-ui/templates/psp.yaml
apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  name: service-catalog-addons-service-catalog-ui
  labels:
    app: service-catalog-ui
    chart: service-catalog-ui-0.1.0
    release: service-catalog-addons
    heritage: Helm
    kyma-project.io/component: frontend
spec:
  allowPrivilegeEscalation: false
  privileged: false
  hostNetwork: false
  hostIPC: false
  hostPID: false
  runAsUser:
    rule: 'MustRunAsNonRoot'
  seLinux:
    rule: 'RunAsAny'
  supplementalGroups:
    rule: 'MustRunAs'
    ranges:
      # Forbid adding the root group.
      - min: 1
        max: 65535
  fsGroup:
    rule: 'MustRunAs'
    ranges:
      # Forbid adding the root group.
      - min: 1
        max: 65535
  readOnlyRootFilesystem: true
  volumes:
    - emptyDir
    - configMap
---
# Source: service-catalog-addons/charts/service-binding-usage-controller/templates/service-account.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: service-catalog-addons-service-binding-usage-controller
  namespace: kyma-system
  labels:
    app: service-catalog-addons-service-binding-usage-controller
    chart: "service-binding-usage-controller-0.1.0"
    release: "service-catalog-addons"
    heritage: "Helm"
---
# Source: service-catalog-addons/charts/service-catalog-ui/templates/rbac.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: service-catalog-addons-service-catalog-ui
  namespace:  kyma-system
  labels:
    app: service-catalog-addons-service-catalog-ui
---
# Source: service-catalog-addons/charts/service-binding-usage-controller/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: "service-binding-usage-controller-process-sbu-spec"
  labels:
    app: service-catalog-addons-service-binding-usage-controller
    chart: "service-binding-usage-controller-0.1.0"
---
# Source: service-catalog-addons/charts/service-binding-usage-controller/templates/dashboard-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: service-binding-usage-controller-dashboard
  labels:
    grafana_dashboard: "1"
    app: monitoring-grafana
data:
  service-binding-usage-controller-dashboard.json: |-
    {
      "annotations": {
        "list": [
          {
            "builtIn": 1,
            "datasource": "-- Grafana --",
            "enable": true,
            "hide": true,
            "iconColor": "rgba(0, 211, 255, 1)",
            "name": "Annotations & Alerts",
            "type": "dashboard"
          }
        ]
      },
      "editable": false,
      "gnetId": null,
      "graphTooltip": 0,
      "id": 7,
      "iteration": 1559633272716,
      "links": [],
      "panels": [
        {
          "collapsed": false,
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 0
          },
          "id": 50,
          "panels": [],
          "title": "Runtime Business Metrics",
          "type": "row"
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "Prometheus",
          "fill": 1,
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 1
          },
          "id": 48,
          "legend": {
            "avg": true,
            "current": false,
            "max": false,
            "min": false,
            "show": true,
            "total": false,
            "values": true
          },
          "lines": true,
          "linewidth": 1,
          "links": [],
          "nullPointMode": "null as zero",
          "paceLength": 10,
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "rate(controller_runtime_reconcile_latency_sum{controller=\"service_binding_usage_controller\"}[1m]) / rate(controller_runtime_reconcile_latency_count{controller=\"service_binding_usage_controller\"}[1m])",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "ServiceBindingUsageController",
              "refId": "A"
            },
            {
              "expr": "rate(controller_runtime_reconcile_latency_sum{controller=\"usage_kind_controller\"}[1m]) / rate(controller_runtime_reconcile_latency_count{controller=\"usage_kind_controller\"}[1m])",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "UsageKindController",
              "refId": "B"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Reconcile Latency",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "short",
              "label": "Average reconcile time [s]",
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "Prometheus",
          "fill": 1,
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 1
          },
          "id": 44,
          "legend": {
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "show": true,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "links": [],
          "nullPointMode": "null as zero",
          "paceLength": 10,
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "stack": false,
          "steppedLine": true,
          "targets": [
            {
              "expr": "increase(controller_runtime_reconcile_queue_length{controller=\"service_binding_usage_controller\"}[1m])",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "ServiceBindingUsageController",
              "refId": "A"
            },
            {
              "expr": "increase(controller_runtime_reconcile_queue_length{controller=\"usage_kind_controller\"}[1m])",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "UsageKindController",
              "refId": "B"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Queue Length",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "decimals": 0,
              "format": "short",
              "label": "Average Queue Length",
              "logBase": 1,
              "max": null,
              "min": "0",
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "Prometheus",
          "fill": 1,
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 9
          },
          "id": 46,
          "legend": {
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "show": true,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "links": [],
          "nullPointMode": "null",
          "paceLength": 10,
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "stack": false,
          "steppedLine": true,
          "targets": [
            {
              "expr": "controller_runtime_reconcile_errors_total{controller=\"service_binding_usage_controller\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "ServiceBindingUsageController",
              "refId": "A"
            },
            {
              "expr": "controller_runtime_reconcile_errors_total{controller=\"usage_kind_controller\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "UsageKindController",
              "refId": "B"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Total Errors",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "decimals": 0,
              "format": "short",
              "label": "Amount of errors",
              "logBase": 1,
              "max": null,
              "min": "0",
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "collapsed": false,
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 17
          },
          "id": 42,
          "panels": [],
          "title": "Runtime Metrics",
          "type": "row"
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "Prometheus",
          "fill": 1,
          "gridPos": {
            "h": 7,
            "w": 8,
            "x": 0,
            "y": 18
          },
          "id": 16,
          "legend": {
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "show": true,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "links": [],
          "nullPointMode": "null",
          "paceLength": 10,
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "go_gc_duration_seconds{service=\"service-catalog-addons-service-binding-usage-controller\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "{{quantile}}",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "GC duration [s]",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "Prometheus",
          "editable": true,
          "error": false,
          "fill": 1,
          "grid": {},
          "gridPos": {
            "h": 7,
            "w": 8,
            "x": 8,
            "y": 18
          },
          "id": 24,
          "isNew": true,
          "legend": {
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "show": true,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 2,
          "links": [],
          "nullPointMode": "connected",
          "paceLength": 10,
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "process_open_fds{service=\"service-catalog-addons-service-binding-usage-controller\"}",
              "format": "time_series",
              "interval": "",
              "intervalFactor": 2,
              "legendFormat": "{{service}}",
              "metric": "process_open_fds",
              "refId": "A",
              "step": 4
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "open fds",
          "tooltip": {
            "msResolution": false,
            "shared": true,
            "sort": 0,
            "value_type": "cumulative"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "Prometheus",
          "fill": 1,
          "gridPos": {
            "h": 7,
            "w": 8,
            "x": 16,
            "y": 18
          },
          "id": 18,
          "legend": {
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "show": true,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "links": [],
          "nullPointMode": "null",
          "paceLength": 10,
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "go_threads{service=\"service-catalog-addons-service-binding-usage-controller\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "{{pod}}",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Gothreads",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "Prometheus",
          "editable": true,
          "error": false,
          "fill": 1,
          "grid": {},
          "gridPos": {
            "h": 7,
            "w": 12,
            "x": 0,
            "y": 25
          },
          "id": 22,
          "isNew": true,
          "legend": {
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "show": true,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 2,
          "links": [],
          "nullPointMode": "connected",
          "paceLength": 10,
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [
            {
              "alias": "alloc rate",
              "yaxis": 2
            }
          ],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "go_memstats_alloc_bytes{service=\"service-catalog-addons-service-binding-usage-controller\"}",
              "format": "time_series",
              "intervalFactor": 2,
              "legendFormat": "bytes allocated",
              "metric": "go_memstats_alloc_bytes",
              "refId": "A",
              "step": 4
            },
            {
              "expr": "rate(go_memstats_alloc_bytes_total{service=\"service-catalog-addons-service-binding-usage-controller\"}[30s])",
              "format": "time_series",
              "intervalFactor": 2,
              "legendFormat": "alloc rate",
              "metric": "go_memstats_alloc_bytes_total",
              "refId": "B",
              "step": 4
            },
            {
              "expr": "go_memstats_stack_inuse_bytes{service=\"service-catalog-addons-service-binding-usage-controller\"}",
              "format": "time_series",
              "intervalFactor": 2,
              "legendFormat": "stack inuse",
              "metric": "go_memstats_stack_inuse_bytes",
              "refId": "C",
              "step": 4
            },
            {
              "expr": "go_memstats_heap_inuse_bytes{service=\"service-catalog-addons-service-binding-usage-controller\"}",
              "format": "time_series",
              "hide": false,
              "intervalFactor": 2,
              "legendFormat": "heap inuse",
              "metric": "go_memstats_heap_inuse_bytes",
              "refId": "D",
              "step": 4
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "go memstats",
          "tooltip": {
            "msResolution": false,
            "shared": true,
            "sort": 0,
            "value_type": "cumulative"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "bytes",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "Bps",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "Prometheus",
          "fill": 1,
          "gridPos": {
            "h": 7,
            "w": 12,
            "x": 12,
            "y": 25
          },
          "id": 17,
          "legend": {
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "show": true,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "links": [],
          "nullPointMode": "null",
          "paceLength": 10,
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "go_goroutines{service=\"service-catalog-addons-service-binding-usage-controller\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "{{pod}}",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Goroutines",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "collapsed": false,
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 32
          },
          "id": 38,
          "panels": [],
          "title": "Kubernetes Metrics",
          "type": "row"
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "Prometheus",
          "editable": true,
          "error": false,
          "fill": 1,
          "grid": {
            "threshold1Color": "rgba(216, 200, 27, 0.27)",
            "threshold2Color": "rgba(234, 112, 112, 0.22)"
          },
          "gridPos": {
            "h": 7,
            "w": 12,
            "x": 0,
            "y": 33
          },
          "id": 10,
          "isNew": false,
          "legend": {
            "alignAsTable": true,
            "avg": true,
            "current": true,
            "hideEmpty": false,
            "hideZero": false,
            "max": false,
            "min": false,
            "rightSide": true,
            "show": true,
            "total": false,
            "values": true
          },
          "lines": true,
          "linewidth": 2,
          "links": [],
          "nullPointMode": "connected",
          "paceLength": 10,
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum by(container) (container_memory_usage_bytes{pod=~\"service-catalog-addons-service-binding-usage-controller.*\", container!=\"POD\"})",
              "format": "time_series",
              "instant": false,
              "interval": "10s",
              "intervalFactor": 1,
              "legendFormat": "Current: {{container}}",
              "metric": "container_memory_usage_bytes",
              "refId": "A",
              "step": 15
            },
            {
              "expr": "kube_pod_container_resource_requests_memory_bytes{pod=~\"service-catalog-addons-service-binding-usage-controller.*\"}",
              "format": "time_series",
              "interval": "10s",
              "intervalFactor": 2,
              "legendFormat": "Requested: {{container}}",
              "metric": "kube_pod_container_resource_requests_memory_bytes",
              "refId": "B",
              "step": 20
            },
            {
              "expr": "kube_pod_container_resource_limits_memory_bytes{pod=~\"service-catalog-addons-service-binding-usage-controller.*\"}",
              "format": "time_series",
              "interval": "10s",
              "intervalFactor": 2,
              "legendFormat": "Limit: {{container}}",
              "metric": "kube_pod_container_resource_limits_memory_bytes",
              "refId": "C",
              "step": 20
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Memory Usage",
          "tooltip": {
            "msResolution": true,
            "shared": true,
            "sort": 0,
            "value_type": "cumulative"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "bytes",
              "logBase": 1,
              "show": true
            },
            {
              "format": "short",
              "logBase": 1,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "Prometheus",
          "editable": true,
          "error": false,
          "fill": 1,
          "grid": {
            "threshold1Color": "rgba(216, 200, 27, 0.27)",
            "threshold2Color": "rgba(234, 112, 112, 0.22)"
          },
          "gridPos": {
            "h": 7,
            "w": 12,
            "x": 12,
            "y": 33
          },
          "id": 8,
          "isNew": false,
          "legend": {
            "alignAsTable": true,
            "avg": true,
            "current": true,
            "hideEmpty": false,
            "hideZero": false,
            "max": false,
            "min": false,
            "rightSide": true,
            "show": true,
            "total": false,
            "values": true
          },
          "lines": true,
          "linewidth": 2,
          "links": [],
          "nullPointMode": "connected",
          "paceLength": 10,
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum by (container)(rate(container_cpu_usage_seconds_total{image!=\"\",container!=\"POD\",pod=~\"service-catalog-addons-service-binding-usage-controller.*\"}[1m]))",
              "format": "time_series",
              "intervalFactor": 2,
              "legendFormat": "{{container}}",
              "refId": "A",
              "step": 30
            },
            {
              "expr": "kube_pod_container_resource_requests_cpu_cores{pod=~\"service-catalog-addons-service-binding-usage-controller.*\"}",
              "format": "time_series",
              "interval": "10s",
              "intervalFactor": 2,
              "legendFormat": "Requested: {{container}}",
              "metric": "kube_pod_container_resource_requests_cpu_cores",
              "refId": "B",
              "step": 20
            },
            {
              "expr": "kube_pod_container_resource_limits_cpu_cores{pod=~\"service-catalog-addons-service-binding-usage-controller.*\"}",
              "format": "time_series",
              "interval": "10s",
              "intervalFactor": 2,
              "legendFormat": "Limit: {{container}}",
              "metric": "kube_pod_container_resource_limits_memory_bytes",
              "refId": "C",
              "step": 20
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "CPU Usage",
          "tooltip": {
            "msResolution": true,
            "shared": true,
            "sort": 0,
            "value_type": "cumulative"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "short",
              "logBase": 1,
              "show": true
            },
            {
              "format": "short",
              "logBase": 1,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "Prometheus",
          "editable": true,
          "error": false,
          "fill": 1,
          "grid": {
            "threshold1Color": "rgba(216, 200, 27, 0.27)",
            "threshold2Color": "rgba(234, 112, 112, 0.22)"
          },
          "gridPos": {
            "h": 7,
            "w": 24,
            "x": 0,
            "y": 40
          },
          "id": 12,
          "isNew": false,
          "legend": {
            "alignAsTable": false,
            "avg": true,
            "current": true,
            "hideEmpty": false,
            "hideZero": false,
            "max": false,
            "min": false,
            "rightSide": false,
            "show": true,
            "total": false,
            "values": true
          },
          "lines": true,
          "linewidth": 2,
          "links": [],
          "nullPointMode": "connected",
          "paceLength": 10,
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sort_desc(sum by (pod) (rate(container_network_receive_bytes_total{pod=~\"service-catalog-addons-service-binding-usage-controller.*\"}[1m])))",
              "format": "time_series",
              "interval": "",
              "intervalFactor": 2,
              "legendFormat": "{{pod}}",
              "refId": "A",
              "step": 30
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Network I/O",
          "tooltip": {
            "msResolution": true,
            "shared": true,
            "sort": 0,
            "value_type": "cumulative"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "bytes",
              "logBase": 1,
              "show": true
            },
            {
              "format": "short",
              "logBase": 1,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        }
      ],
      "refresh": "10s",
      "schemaVersion": 18,
      "style": "dark",
      "tags": [
        "service-catalog",
        "kyma"
      ],
      "templating": {
        "list": [
          {
            "current": {
              "selected": true,
              "text": "service-catalog-apiserver",
              "value": "service-catalog-apiserver"
            },
            "hide": 2,
            "label": null,
            "name": "apiserverdeploy",
            "options": [
              {
                "selected": true,
                "text": "service-catalog-apiserver",
                "value": "service-catalog-apiserver"
              }
            ],
            "query": "service-catalog-apiserver",
            "skipUrlSync": false,
            "type": "constant"
          },
          {
            "current": {
              "selected": true,
              "text": "service-catalog-controller-manager",
              "value": "service-catalog-controller-manager"
            },
            "hide": 2,
            "label": null,
            "name": "controllerdeploy",
            "options": [
              {
                "selected": true,
                "text": "service-catalog-controller-manager",
                "value": "service-catalog-controller-manager"
              }
            ],
            "query": "service-catalog-controller-manager",
            "skipUrlSync": false,
            "type": "constant"
          },
          {
            "current": {
              "selected": true,
              "text": "service-catalog-etcd-stateful-client",
              "value": "service-catalog-etcd-stateful-client"
            },
            "hide": 2,
            "label": null,
            "name": "etcd_cluster",
            "options": [
              {
                "selected": true,
                "text": "service-catalog-etcd-stateful-client",
                "value": "service-catalog-etcd-stateful-client"
              }
            ],
            "query": "service-catalog-etcd-stateful-client",
            "skipUrlSync": false,
            "type": "constant"
          },
          {
            "current": {
              "selected": true,
              "text": "service-catalog-etcd-stateful",
              "value": "service-catalog-etcd-stateful"
            },
            "hide": 2,
            "label": null,
            "name": "etcddeploy",
            "options": [
              {
                "selected": true,
                "text": "service-catalog-etcd-stateful",
                "value": "service-catalog-etcd-stateful"
              }
            ],
            "query": "service-catalog-etcd-stateful",
            "skipUrlSync": false,
            "type": "constant"
          }
        ]
      },
      "time": {
        "from": "now-1h",
        "to": "now"
      },
      "timepicker": {
        "refresh_intervals": [
          "5s",
          "10s",
          "30s",
          "1m",
          "5m",
          "15m",
          "30m",
          "1h",
          "2h",
          "1d"
        ],
        "time_options": [
          "5m",
          "15m",
          "1h",
          "6h",
          "12h",
          "24h",
          "2d",
          "7d",
          "30d"
        ]
      },
      "timezone": "",
      "title": "Kyma / Service Catalog Add-ons / Binding Usage Controller",
      "uid": "_MIdIJiZz",
      "version": 1
    }
---
# Source: service-catalog-addons/charts/service-catalog-ui/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: service-catalog-ui
  labels:
    app: service-catalog-ui
    chart: service-catalog-ui-0.1.0
data:
  config.js: |
    window.clusterConfig = {
      catalogUrl: '/home/environments/{CURRENT_ENV}/catalog',
      graphqlApiUrl: 'https://console-backend.ed200f3.dev.kyma.ondemand.com/graphql',
      subscriptionsApiUrl: 'wss://console-backend.ed200f3.dev.kyma.ondemand.com/graphql',
    };
---
# Source: service-catalog-addons/charts/service-binding-usage-controller/templates/cluster-role.yaml
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: service-catalog-addons-service-binding-usage-controller
  labels:
    app: service-catalog-addons-service-binding-usage-controller
    chart: "service-binding-usage-controller-0.1.0"
    release: "service-catalog-addons"
    heritage: "Helm"
rules:
- apiGroups: ["settings.svcat.k8s.io"]
  resources: ["podpresets"]
  verbs: ["create", "delete"]
- apiGroups: ["apps"]
  resources: ["deployments"]
  verbs: ["get", "list", "watch", "patch", "update"]
- apiGroups: ["serverless.kyma-project.io"]
  resources: ["functions"]
  verbs: ["get", "list", "watch", "patch", "update"]
- apiGroups: ["servicecatalog.kyma-project.io"]
  resources: ["servicebindingusages", "usagekinds"]
  verbs: ["get", "list", "watch", "create", "update", "delete"]
- apiGroups: ["servicecatalog.k8s.io"]
  resources: ["servicebindings","serviceinstances","clusterserviceclasses","serviceclasses"]
  verbs:     ["get","list","watch"]
- apiGroups: [""]
  resources: ["events"]
  verbs: ["patch", "create"]
- apiGroups: [""]
  resources: ["configmaps"]
  verbs: ["get", "delete", "update"]
  resourceNames:
    - "service-binding-usage-controller-process-sbu-spec"
---
# Source: service-catalog-addons/charts/service-binding-usage-controller/templates/cluster-role-binding.yaml
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: service-catalog-addons-service-binding-usage-controller
  labels:
    app: service-catalog-addons-service-binding-usage-controller
    chart: "service-binding-usage-controller-0.1.0"
    release: "service-catalog-addons"
    heritage: "Helm"
subjects:
- kind: ServiceAccount
  name: service-catalog-addons-service-binding-usage-controller
  namespace: kyma-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: service-catalog-addons-service-binding-usage-controller
---
# Source: service-catalog-addons/charts/service-catalog-ui/templates/rbac.yaml
kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: service-catalog-addons-service-catalog-ui
  namespace:  kyma-system
rules:
  - apiGroups: ["extensions","policy"]
    resources: ["podsecuritypolicies"]
    verbs: ["use"]
    resourceNames: 
      - service-catalog-addons-service-catalog-ui
---
# Source: service-catalog-addons/charts/service-catalog-ui/templates/rbac.yaml
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: service-catalog-addons-service-catalog-ui
  namespace:  kyma-system
subjects:
  - kind: ServiceAccount
    name: service-catalog-addons-service-catalog-ui
    namespace:  kyma-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: service-catalog-addons-service-catalog-ui
---
# Source: service-catalog-addons/charts/service-binding-usage-controller/templates/service.yaml
# Dedicated Service for metrics endpoint
apiVersion: v1
kind: Service
metadata:
  name: service-catalog-addons-service-binding-usage-controller
  labels:
    app: service-catalog-addons-service-binding-usage-controller
    chart: "service-binding-usage-controller-0.1.0"
    release: "service-catalog-addons"
    heritage: "Helm"
spec:
  ports:
  - name: http-metrics
    port: 8080
  selector:
    app: service-catalog-addons-service-binding-usage-controller
---
# Source: service-catalog-addons/charts/service-catalog-ui/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: service-catalog-addons-service-catalog-ui
  labels:
    app: service-catalog-ui
    chart: service-catalog-ui-0.1.0
    release: service-catalog-addons
    heritage: Helm
spec:
  ports:
  - port: 80
    targetPort: 80
    protocol: TCP
    name: http2
  selector:
    app: service-catalog-ui
---
# Source: service-catalog-addons/charts/service-binding-usage-controller/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: service-catalog-addons-service-binding-usage-controller
  labels:
    app: service-catalog-addons-service-binding-usage-controller
    chart: service-binding-usage-controller-0.1.0
    release: service-catalog-addons
    heritage: Helm
    kyma-project.io/component: controller
spec:
  replicas: 1
  selector:
    matchLabels:
      app: service-catalog-addons-service-binding-usage-controller
      release: service-catalog-addons
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: "true"
      labels:
        app: service-catalog-addons-service-binding-usage-controller
        release: service-catalog-addons
        kyma-project.io/component: controller
    spec:
      serviceAccountName: service-catalog-addons-service-binding-usage-controller
      securityContext:
        runAsUser: 2000
      containers:
        - name: service-binding-usage-controller
          image: "eu.gcr.io/kyma-project/service-binding-usage-controller:ef49b0f6"
          imagePullPolicy: IfNotPresent
          securityContext:
            privileged: false
            allowPrivilegeEscalation: false
          resources:
            limits:
              cpu: 100m
              memory: 96Mi
            requests:
              cpu: 50m
              memory: 48Mi
          env:
            - name: APP_LOGGER_LEVEL
              value: "debug"
            - name: APP_APPLIED_SBU_CONFIG_MAP_NAME
              value: "service-binding-usage-controller-process-sbu-spec"
            - name: APP_APPLIED_SBU_CONFIG_MAP_NAMESPACE
              value: "kyma-system"
          ports:
            - containerPort: 8080
          livenessProbe:
            httpGet:
              path: /statusz
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 2
            successThreshold: 1
            initialDelaySeconds: 15
      priorityClassName: kyma-system
---
# Source: service-catalog-addons/charts/service-catalog-ui/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: service-catalog-addons-service-catalog-ui
  labels:
    app: service-catalog-ui
    chart: service-catalog-ui-0.1.0
    release: service-catalog-addons
    heritage: Helm
    kyma-project.io/component: frontend
spec:
  selector:
    matchLabels:
      app: service-catalog-ui
      release: service-catalog-addons
  replicas: 1
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: "false"
      labels:
        app: service-catalog-ui
        release: service-catalog-addons
        kyma-project.io/component: frontend
    spec:
      serviceAccountName: service-catalog-addons-service-catalog-ui
      containers:
        - name: service-catalog-ui
          image: "eu.gcr.io/kyma-project/service-catalog-ui:10709d94"
          imagePullPolicy: IfNotPresent
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
          resources:
            limits:
              cpu: 60m
              memory: 64Mi
            requests:
              cpu: 10m
              memory: 16Mi
          ports:
            - containerPort: 80
          volumeMounts:
          - name: config
            mountPath: /var/public/config
      volumes:
      - name: config
        configMap:
          name: service-catalog-ui
          items:
          - key: config.js
            path: config.js
      priorityClassName: kyma-system
---
# Source: service-catalog-addons/charts/service-catalog-ui/templates/destination-rule.yaml
apiVersion: "networking.istio.io/v1alpha3"
kind: "DestinationRule"
metadata:
  name: service-catalog-addons-service-catalog-ui
spec:
  host: service-catalog-addons-service-catalog-ui.kyma-system.svc.cluster.local
  trafficPolicy:
    tls:
      mode: DISABLE
---
# Source: service-catalog-addons/charts/service-binding-usage-controller/templates/policy.yaml
# Required because the Binding Usage Controller has Istio sidecar but Prometheus Operator doesn't
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: service-catalog-addons-service-binding-usage-controller
spec:
  selector:
    matchLabels:
      app: service-catalog-addons-service-binding-usage-controller
  mtls:
    mode: "PERMISSIVE"
---
# Source: service-catalog-addons/charts/service-binding-usage-controller/templates/service-monitor.yaml
# Inform Prometheus to scrap the metrics endpoint
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: service-catalog-addons-service-binding-usage-controller
  labels:
    prometheus: monitoring
    app: service-catalog-addons-service-binding-usage-controller
    chart: "service-binding-usage-controller-0.1.0"
    release: "service-catalog-addons"
    heritage: "Helm"
spec:
  endpoints:
    - port: http-metrics
      metricRelabelings:
      - sourceLabels: [ __name__ ]
        regex: ^(controller_runtime_reconcile_latency_sum|controller_runtime_reconcile_latency_count|controller_runtime_reconcile_queue_length|controller_runtime_reconcile_errors_total|go_gc_duration_seconds|go_goroutines|go_memstats_alloc_bytes|go_memstats_heap_alloc_bytes|go_memstats_heap_inuse_bytes|go_memstats_heap_sys_bytes|go_memstats_stack_inuse_bytes|go_threads|process_cpu_seconds_total|process_max_fds|process_open_fds|process_resident_memory_bytes|process_start_time_seconds|process_virtual_memory_bytes)$
        action: keep
  namespaceSelector:
    matchNames:
      - "kyma-system"
  selector:
    matchLabels:
      app: service-catalog-addons-service-binding-usage-controller
---
# Source: service-catalog-addons/charts/service-binding-usage-controller/templates/deployment-usage-kind.yaml
apiVersion: servicecatalog.kyma-project.io/v1alpha1
kind: UsageKind
metadata:
   name: deployment
spec:
   displayName: Deployment
   resource:
     group: apps
     kind: deployment
     version: v1
   labelsPath: spec.template.metadata.labels
---
# Source: service-catalog-addons/charts/service-catalog-ui/templates/catalog-virtualservice.yaml
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: service-catalog-addons-service-catalog-ui-catalog
  labels:
    app: service-catalog-ui
    chart: service-catalog-ui-0.1.0
    heritage: Helm
    release: service-catalog-addons
spec:
  hosts:
  - catalog.ed200f3.dev.kyma.ondemand.com
  gateways:
  - kyma-gateway
  http:
  - match:
    - uri:
        regex: /.*
    route:
    - destination:
        port:
          number: 80
        host: service-catalog-addons-service-catalog-ui

